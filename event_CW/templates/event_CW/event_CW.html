<!--
# Copyright 2014 University of Messina (UniMe)
#
# Author: Carmelo Romeo <caromeo@unime.it>
#
# Licensed under the Apache License, Version 2.0 (the "License"); you may
# not use this file except in compliance with the License. You may obtain
# a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
# License for the specific language governing permissions and limitations
# under the License.

# -*- encoding: utf-8 -*-
#
# Author: Carmelo Romeo <caromeo@unime.it>
#
#
-->

{% load i18n %}
{% load url from future %}

<!-- Added inside folder /usr/lib/python2.6/site-packages/horizon/templatetags/ a python file (set_var.py) which contains the template for "set" command in template html style -->
{% load set_var %}

<script type="text/javascript">

	//Define the startsWith function to find a string at the beginning of another one
	if ( typeof String.prototype.startsWith != 'function' ) { 
		String.prototype.startsWith = function( str ) {
			return this.substring( 0, str.length ) === str;
		}
	};

	//Function to insert only numbers inside "samples_number" input
	function isNumberKey(evt){
		var charCode = (evt.which) ? evt.which : evt.keyCode
		if (charCode > 31 && (charCode < 48 || charCode > 57))
			return false;
		return true;
	}

	//Function to check if an element already exists in an array
	function vect_contains(vect, obj) {
		for (var i = 0; i < vect.length; i++) {
			if (vect[i] === obj) 
				return true;
		}
		return false;
	}

	//GLOBAL VARIABLES
	//Extraction of name, title and resource_id of the metrics to be compared with the selected resource_id
	var name_list = [];
	var resourceid_list = [];
        {% for meter in vmmeters %}
                name_list.push("{{ meter.name }}");
                resourceid_list.push("{{ meter.resource_id }}");
        {% endfor %}

	//Extraction of VM name and resource_id from vms list (vms)
	var vm_name_list = [];
	var vm_id_list = [];
	{% for vm in vms %}
		vm_name_list.push("{{ vm.name }}");
		vm_id_list.push("{{ vm.id }}");
	{% endfor %}

	//Extraction of Heat stack id, name and related resources
	var stack_id_list = [];
	var stack_name_list = [];
	var stack_resources_list = [];

	{% for stack in stacks_info %}
		stack_id_list.push("{{ stack.stack_id }}");
		stack_name_list.push("{{ stack.stack_name }}");
		//alert("stack_id: {{ stack.stack_id }} stack_name: {{ stack.stack_name }}");
		stack_resources_list.push("{{ stack.resources_number }}");

		{% for resource in stack.stack_resources %}
			stack_resources_list.push("{{ resource.stack_resource_id }}, {{ resource.stack_resource_name }}");
			//alert("temp_array: "+temp_array+ "  res_list: "+stack_resources_list);
		{% endfor %}
	{% endfor %}
	//alert("len: "+ stack_resources_list.length + " vect: "+stack_resources_list);

	//Extraction of Events: stack_id, name, events_list
	var events_list = [];
	var types_list = [];
	{% for stack in stacks_events_obj %}
		{% for event_obj in stack.stack_events %}
			events_list.push("{{ stack.stack_id }}; {{ event_obj.cw_event_type }}; {{ event_obj.cw_event_name }}; {{ event_obj.timestamp }}; {{ event_obj.cw_payload }}");		

			//if(!vect_contains(types_list, "{{ event_obj.cw_event_type }}"))
			//	types_list.push("{{ event_obj.cw_event_type }}")
		{% endfor %}
	{% endfor %}

	//for(e=0; e<events_list.length; e++) alert(events_list[e]);

	//OTHER USEFUL VARIABLES
	//Copy the stack_resources_list vector to a temporary one
	var temp_stack_resources_list = stack_resources_list.slice();
	var association_stackid_vms = [];

	for(s=0; s<stack_id_list.length; s++){
		for(i=0; i<temp_stack_resources_list.length; i++){
			//Check if the "i"-th element of the resources list vector represents the number of resources associated to the "j"-th stack_id. 
			//If YES we need to find the vm_id in order to retrieve the relative metrics list afterwards.
			if(/^\d+$/.test(temp_stack_resources_list[i])){
				var count =0;
				for(j=i+1; j<=i+temp_stack_resources_list[i] && j<temp_stack_resources_list.length; j++){
					var flag = "True";
					for(k=0; k<vm_id_list.length; k++){
						if(temp_stack_resources_list[j].split(',')[0] == vm_id_list[k]){
							if(flag == "True") {
								association_stackid_vms.push("STACKID:"+stack_id_list[s], vm_id_list[k], vm_name_list[k]); 
								flag = "False"; 
							}
							else    association_stackid_vms.push(vm_id_list[k], vm_name_list[k]);
						}
					}
					count++;
				}
				for(x=0;x<count+1;x++) temp_stack_resources_list.shift();
				break;
			}
		}
	}

	window.onload = function() {
		$("#stack_vms1").hide();

		//START new multigraph
		$("#chartst1").hide();
		$("#chart_containerst1").hide();
		//STOP new multigraph
	}


	// EVENTS FUNCTIONS
	//---------------------------------------------------------------------------------------------------------------------------------------------------
	function show_cw_events_x_stackid(val){

		var line_number = val.id.substring(6,val.id.length);

		if(val.value =="--"){
			$(".stackevent_types"+line_number).hide();

			$(".events"+line_number).hide();
			$(".event_metrics"+line_number).hide();
			$(".event_vms"+line_number).hide();
			$("#chartst"+line_number).hide();
			$("#chart_containerst"+line_number).hide();
			$("#legendst"+line_number).hide();
			//document.getElementById('chart_containerst'+line_number).innerHTML = "";
		}
		else{
			$(".events"+line_number).hide();
                        $(".event_metrics"+line_number).hide();
                        $(".event_vms"+line_number).hide();
                        $("#chartst"+line_number).hide();
                        $("#chart_containerst"+line_number).hide();
                        $("#legendst"+line_number).hide();

			var cw_types_element = document.getElementById("cw_event_types"+line_number);

			{% set line_number  = ""+line_number+"" %}

			var string_pre =" \
				<div class='form-group'> \
				<label for='event' class='stackevent_types{{ line_number }} control-label col-sm-2'>{% trans 'Adaptation Types' %}:&nbsp;</label> \
					<input name='offset_time' type='hidden' id='offset_time{{ line_number }}' value='' /> \
					<div class='controls line_chart_time_picker'> \
						<select name='stackevent_types' id='stackevent_types{{ line_number }}' class='form-control stackevent_types{{ line_number }}' value='stackevent_types{{ line_number }}' onchange='show_selected_events(this);' style='width: auto'>";

			var string_types ="";

			string_types += " \
					<optgroup label='{% trans "Types" %}'>";

			var string_post = "</optgroup> \
						</select> \
					</div> \
				</div>";

			cw_types_element.innerHTML = string_pre+" "+string_types+" "+string_post;

			$('#stackevent_types'+line_number).append('<option title="--" value="--">--</option>');
		
			var selects = document.getElementById("stacks{{ line_number }}");

			var stack_event_types_list = [];
			for(e=0; e<events_list.length; e++){
				//events_list.push("{{ stack.stack_id }}, {{ event_obj.cw_event_type }}, {{ event_obj.cw_event_name }}, {{ event_obj.timestamp }}, {{ event_obj.cw_payload }}")
				if(events_list[e].split('; ')[0] == selects.options[selects.selectedIndex].value){
					if(!vect_contains(stack_event_types_list, events_list[e].split('; ')[2]))
						stack_event_types_list.push(events_list[e].split('; ')[2]);
				}
			}


			for(j=0; j<stack_event_types_list.length; j++){
				$('#stackevent_types'+line_number).append('<option title="'+stack_event_types_list[j]+'" value="'+stack_event_types_list[j]+'" data-unit="">'+stack_event_types_list[j]+'</option>');
			}
		}
	}


	function show_selected_events(val){

		var line_number = val.id.substring(16,val.id.length);

		if(val.value =="--"){
			$(".events"+line_number).hide();

			$(".event_metrics"+line_number).hide();
			$(".event_vms"+line_number).hide();
                        $("#chartst"+line_number).hide();
                        $("#chart_containerst"+line_number).hide();
                        $("#legendst"+line_number).hide();
		}
		else{

                        $(".event_metrics"+line_number).hide();
                        $(".event_vms"+line_number).hide();
                        $("#chartst"+line_number).hide();
                        $("#chart_containerst"+line_number).hide();
                        $("#legendst"+line_number).hide();

			var events_list_element = document.getElementById("events_list"+line_number);


			//FIX date offset from UTC
			//----------------------------------------------------------------------------------
			var data = new Date();
			document.getElementById('offset_time'+line_number).value = -data.getTimezoneOffset();
			var hours_offset = document.getElementById('offset_time'+line_number).value / 60;
			//----------------------------------------------------------------------------------

			{% set line_number  = ""+line_number+"" %}

			var string_pre =" \
	                       <div class='form-group'> \
                                  <label for='event' class='events{{ line_number }} control-label col-sm-2'>{% trans 'Events List' %}:&nbsp;</label> \
        	                       <div class='controls line_chart_time_picker'> \
                                        <select data-line-chart-command='select_box_realtime_change' style='width: auto' name='meter' id='events{{ line_number }}' class='form-control events{{ line_number }}' value='events{{ line_number }}' onchange='show_metrics_x_event(this);'> ";

                        var string_events = " \
                                        <optgroup label='{% trans "Events" %}'>";

                        var string_post = "</optgroup> \
                                                </select> \
                                        </div> \
                                </div>";

			events_list_element.innerHTML = string_pre+" "+string_events+" "+string_post;

			$('#events'+line_number).append('<option title="--" value="--">--</option>');

			var stack_selects = document.getElementById("stacks{{ line_number }}");
			var selects = document.getElementById("stackevent_types{{ line_number }}");

			var events_occurrence = [];
			var date_vect = [];
			var obj = [];
			var date_orig = [];
			for(e=0; e<events_list.length; e++){
				//events_list.push("{{ stack.stack_id }}; {{ event_obj.cw_event_type }}; {{ event_obj.cw_event_name }}; {{ event_obj.timestamp }}; {{ event_obj.cw_payload }}")
				//if( (events_list[e].split('; ')[1]+'.'+events_list[e].split('; ')[2] == selects.options[selects.selectedIndex].value) && (events_list[e].split('; ')[0] == stack_selects.options[stack_selects.selectedIndex].value) ){
				if( (events_list[e].split('; ')[2] == selects.options[selects.selectedIndex].value) && (events_list[e].split('; ')[0] == stack_selects.options[stack_selects.selectedIndex].value) ){
					date_vect = (events_list[e].split('; ')[3]).split('T');
					new_date = date_vect[0]+' '+date_vect[1].substring(0,8);


					new_date = new Date(new_date);
					new_date.setHours(new_date.getHours() + hours_offset);

                                        //Get date fields before showing the NOT UTC format date
                                        var year = new_date.getFullYear();
                                        var month = (new_date.getMonth()+1) > 9 ? (new_date.getMonth()+1) : "0" + (new_date.getMonth()+1);
                                        var day = (new_date.getDate()) > 9 ? (new_date.getDate()) : "0" + (new_date.getDate());
                                        var hours = (new_date.getHours()) > 9 ? (new_date.getHours()) : "0" + (new_date.getHours());
                                        var minutes = (new_date.getMinutes()) > 9 ? (new_date.getMinutes()) : "0" + (new_date.getMinutes());
                                        var seconds = (new_date.getSeconds()) > 9 ? (new_date.getSeconds()) : "0" + (new_date.getSeconds());
                                        new_date = day+'/'+month+'/'+year+' '+hours+':'+minutes+':'+seconds;


					events_occurrence.push(new_date);

					obj.push(JSON.parse(events_list[e].split('; ')[4].replace(/&quot;/g, '"')));
					date_orig.push(events_list[e].split('; ')[3]);
				}
			}

			for(j=0; j<events_occurrence.length; j++)
				$('#events'+line_number).append('<option title="'+events_occurrence[j]+'" value="'+obj[j].metrics+';'+date_orig[j]+'" data-unit="">'+events_occurrence[j]+'</option>');
		}
	}


	function show_metrics_x_event(val){

		var line_number = val.id.substring(6,val.id.length);

                if(val.value =="--"){
                        $(".event_metrics"+line_number).hide();

			$(".event_vms"+line_number).hide();
                        $("#chartst"+line_number).hide();
                        $("#chart_containerst"+line_number).hide();
                        $("#legendst"+line_number).hide();
                }
                else{

                        $(".event_vms"+line_number).hide();
                        $("#chartst"+line_number).hide();
                        $("#chart_containerst"+line_number).hide();
                        $("#legendst"+line_number).hide();

                        var metrics_element = document.getElementById("metrics_x_event"+line_number);

                        {% set line_number  = ""+line_number+"" %}

                        var string_pre =" \
                                <div class='form-group'> \
                                <label for='metric' class='event_metrics{{ line_number }} control-label col-sm-2'>{% trans 'Metrics' %}:&nbsp;</label> \
                                        <div class='controls line_chart_time_picker'> \
                                                <select name='event_metrics' id='event_metrics{{ line_number }}' class='form-control event_metrics{{ line_number }}' value='event_metrics{{ line_number }}' onchange='show_vms(this);' style='width: auto'>";

                        string_metrics = " \
                                        <optgroup label='{% trans "Metrics" %}'>";

                        var string_post = "</optgroup> \
                                                </select> \
                                        </div> \
                                </div>";

                        metrics_element.innerHTML = string_pre+" "+string_metrics+" "+string_post;

                        $('#event_metrics'+line_number).append('<option title="--" value="--">--</option>');
                
                        var selects = document.getElementById("events{{ line_number }}");
			event_metrics_list = [];
			event_metrics_list = selects.options[selects.selectedIndex].value.split(';')[0].split(',');
			event_timestamp = selects.options[selects.selectedIndex].value.split(';')[1];
			
			for(j=0; j<event_metrics_list.length; j++)
				$('#event_metrics'+line_number).append('<option title="'+event_metrics_list[j]+'" value="'+event_metrics_list[j]+'" data-unit="">'+event_metrics_list[j]+'</option>');
		}
	}



	function show_vms(val){
		var line_number = val.id.substring(13,val.id.length);

                if(val.value =="--"){
                        $(".event_vms"+line_number).hide();

                        $("#chartst"+line_number).hide();
                        $("#chart_containerst"+line_number).hide();
                        $("#legendst"+line_number).hide();
                }
                else{

                        $("#chartst"+line_number).hide();
                        $("#chart_containerst"+line_number).hide();
                        $("#legendst"+line_number).hide();

                        var metrics_element = document.getElementById("vms_x_event"+line_number);

                        {% set line_number  = ""+line_number+"" %}

                        var string_pre =" \
				<div class='form-group event_vms{{ line_number }}'> \
				<label class='control-label col-sm-2'>{% trans 'Time Window' %}:&nbsp;</label> \
					<table> \
					<tr> \
						<td><input name='timestamp' type='hidden' class='form-control' id='timestamp{{ line_number }}' /></td> \
						<input name='vms_selected_list' type='hidden' id='vms_selected_list{{ line_number }}' value='' /> \
						<input name='renderer' type='hidden' id='renderer{{ line_number }}' value='multi-with-event' /> \
						<td><input name='samples_number' type='text' id='samples_number{{ line_number }}' class='form-control' style='width:50px' value='100' maxlength='3' size='3' onKeyPress='return isNumberKey(event)'/> </td> \
						<td> \
							<select class='form-control' name='delta_t' id='delta_t{{ line_number }}' style='width: auto'> \
								<option title='seconds' value='1'>sec</option> \
								<option title='minutes' value='60'>min</option> \
								<option title='hours' value='3600'>hour</option> \
							</select> \
						</td> \
					</tr> \
					</table> \
				</div> \
                                <div class='form-group'> \
                                <label for='metric' class='event_vms{{ line_number }} control-label col-sm-2'>{% trans 'VMS' %}:&nbsp;</label> \
                                        <div class='controls line_chart_time_picker'> \
                                                <select name='event_vms' id='event_vms{{ line_number }}' multiple='multiple'class='form-control event_vms{{ line_number }}' value='event_vms{{ line_number }}' onchange='set_time(this);' style='width: auto'>";

                        string_vms = " \
                                        <optgroup label='{% trans "Virtual Machines" %}'>";

                        var string_post = "</optgroup> \
                                                </select> \
                                        </div> \
                                </div> \
				<button class='btn btn-default btn-sm event_vms{{ line_number }}' type='button' style='vertical-align:top;' id='buttonst{{ line_number }}' data-line-chart-command='button_realtime_plot' value=0 onclick='change_button(this);'>Plot</button>";


                        var new_vm_id_list = [];
                        var new_vm_name_list = [];
                        var selects = document.getElementById("stacks{{ line_number }}");

                        for(i=0; i<association_stackid_vms.length; i++){
                                if(association_stackid_vms[i].split('STACKID:')[1] == selects.options[selects.selectedIndex].value){
                                        new_vm_id_list.push(association_stackid_vms[i+1]);
                                        new_vm_name_list.push(association_stackid_vms[i+2]);
                                        //alert(association_stackid_vms[i+1]+" "+association_stackid_vms[i+2]);
                                }
                        }

			//Select only those VMs that have ever sent the selected kind of metric
                        for (i=0; i<name_list.length; i++){
                                //If clauses to list only those metrics related to the selected (val.value) instance [resource_id]
                                if(name_list[i] == val.value){
                                        for(j=0; j<new_vm_id_list.length; j++){
                                                if(new_vm_id_list[j] == resourceid_list[i]){
                                                        var concat_name_resourceid = name_list[i]+';'+new_vm_id_list[j];
                                                        string_vms +="<option title="+new_vm_name_list[j]+" value="+concat_name_resourceid+" data-unit=''>"+new_vm_name_list[j]+" </option>";
                                                }
                                        }
                                }
                        }

			metrics_element.innerHTML = string_pre+" "+string_vms+" "+string_post;

		}
	 }

	//---------------------------------------------------------------------------------------------------------------------------------------------------


	//Change Plot button style
        function change_button(val){

                var SelectedOptions = document.getElementById("event_vms"+val.id.substring(8,val.id.length));

                if(SelectedOptions.value != ''){
                  if(val.value ==0){
                        document.getElementById(val.id).value =1;

                        document.getElementById(val.id).style.color='#fff';
                        document.getElementById(val.id).style.backgroundColor='#139f33';
                        document.getElementById(val.id).style.borderColor='#118f2f';
                        document.getElementById(val.id).innerHTML="Refresh";
                  }
		  /*
                  else{
                        document.getElementById(val.id).value =0;

                        document.getElementById(val.id).style.color='#333';
                        document.getElementById(val.id).style.backgroundColor='#fff';
                        document.getElementById(val.id).style.borderColor='#ccc';
                        document.getElementById(val.id).innerHTML="Plot";
                  }
		  */
                }
        }


	//Function to set thread_start_time
	function set_time(val){

		//Set hidden timestamp
		document.getElementById('timestamp'+val.id.substring(9,val.id.length)).value = document.getElementById('events'+val.id.substring(9,val.id.length)).value.split(';')[1];
		//document.getElementById('timestamp'+val.id.substring(9,val.id.length)).value = document.getElementById('events'+val.id.substring(9,val.id.length)).title;

		//Function to populate the vm_selected_list input.value
                var SelectedOptions = document.getElementById("event_vms"+val.id.substring(9,val.id.length));
                var list='';
                
		//creating the string with resourceId (and other fields ';'-separated) of the selected lines (vms) divided with '&'
                for (var i=0;i<SelectedOptions.length;i++) {
                        if (SelectedOptions.options[i].selected) {
                                list += list == '' ? SelectedOptions.options[i].value + ";" + SelectedOptions.options[i].text : "&"+SelectedOptions.options[i].value + ";" + SelectedOptions.options[i].text;
                        }
                }


               	document.getElementById('vms_selected_list'+val.id.substring(9,val.id.length)).value = list;

                if(list == ''){
                        alert("You should choose at least one (or more) Virtual Machine(s) !");
			//document.getElementById('delta_t'+val.id.substring(9,val.id.length)).readOnly = false;

                        $("#chartst"+val.id.substring(9,val.id.length)).hide();
                        $("#chart_containerst"+val.id.substring(9,val.id.length)).hide();
                        $("#legendst"+val.id.substring(9,val.id.length)).hide();


                        document.getElementById("buttonst"+val.id.substring(9,val.id.length)).value =0;
                        document.getElementById("buttonst"+val.id.substring(9,val.id.length)).style.color='#333';
                        document.getElementById("buttonst"+val.id.substring(9,val.id.length)).style.backgroundColor='#fff';
                        document.getElementById("buttonst"+val.id.substring(9,val.id.length)).style.borderColor='#ccc';
                        document.getElementById("buttonst"+val.id.substring(9,val.id.length)).innerHTML="Plot";

                        return;
                }
		/*
		else 
			document.getElementById('delta_t'+val.id.substring(9,val.id.length)).readOnly = true;
		*/
	}
	


	//Add/remove metrics from stack application START
	function removemetricst(val){
		//document.getElementById('new_metric_lineva'+val.value).innerHTML = "";
			
	        //CARMELO - TO BE REMOVED???? In events there is no thread!
        	//***************************************************************************
		if ($("#buttonst"+val.value).data("container") != null){
	                clearInterval($("#buttonst"+val.value).data("container").thread);
		}
		document.getElementById('new_metric_linest'+val.value).remove();
		
	        //***************************************************************************
	}

	function addmetricst(val){

		var next_num = parseInt(val.value)+1;
		document.getElementById('afterst'+val.value).style.display = 'none';

		document.getElementById("new_metricst"+val.value).innerHTML=(" \
		{% set next_metric  = ""+next_num+"" %} \
		<div id='new_metric_linest{{ next_metric }}'> \
			<form class='form-horizontal' \
			id='linechart_general_form{{ next_metric }}' > \
				<div class='form-group'> \
				<label for='stacks' class='control-label col-sm-2'>{% trans "Stack_id" %}:&nbsp;</label> \
					<div class='col-sm-2'> \
					  <select name='stacks' id='stacks{{ next_metric }}' class='form-control' onchange='show_cw_events_x_stackid(this);' style='width: auto'> \
					  <optgroup label='{% trans "Stacks" %}'> \
						<option title='--' value='--'>--</option> \
							{% for stack in stacks_info %} \
						<option title='{{ stack.stack_name }}' value='{{ stack.stack_id }}' data-unit=''> \
							{{ stack.stack_name }} \
						</option> \
							{% endfor %} \
					  </optgroup> \
		 			  </select> \
			     	         </div> \
				</div> \
				<p id='cw_event_types{{ next_metric }}'></p> \
				<p id='events_list{{ next_metric }}'></p> \
				<p id='metrics_x_event{{ next_metric }}'></p> \
				<p id='vms_x_event{{ next_metric }}'></p> \
		        </form> \
		        <table> \
			  <tr> \
	   			<td><button class='btn btn-small' type='submit' style='vertical-align:top;' value='{{ next_metric }}' onclick='removemetricst(this);'>Remove Metric</button></td> \
			  </tr> \
		        </table> \
			<div class='info row detail'> \
			<div id='chart_containerst{{ next_metric }}' class='col-sm-9 chart_container' style='display:inline-block;width:75%;'> \
                                <div id='chartst{{ next_metric }}' class='chart' \
					data-chart-type='line_chart' \
					data-url='{% url "horizon:admin:event_CW:samples"%}' \
					data-form-selector='#linechart_general_form{{ next_metric }}' \
                                        data-legend-selector='#legendst{{ next_metric }}' \
                                        data-smoother-selector='#smootherst{{ next_metric }}' \
                                        data-slider-selector='#sliderst{{ next_metric }}'> \
                                </div> \
				<div id='sliderst{{ next_metric }}'></div> \
			</div> \
		        <div id='legendst{{ next_metric }}' style='display:inline-block;width:20%;'></div> \
                        </div> \
		</div> \
	        <div id='afterst{{ next_metric }}'> \
			&nbsp;&nbsp; \
			<table> \
			  <tr> \
			   <td><button class='btn btn-small' type='submit' style='vertical-align:top;' value='{{ next_metric }}' onclick='addmetricst(this);'>Add Metric</button></td> \
			  </tr> \
			</table> \
	        </div> \
		<!-- This is the section inside which new metric lines will be added and removed from --> \
	        <div id='new_metricst{{ next_metric }}'></div> \
			")

		//START - Onload of the new metric section
                $("#stack_vms"+next_num).hide();
                $("#chartst"+next_num).hide();
                $("#chart_containerst"+next_num).hide();
		//STOP - Onload of the new metric section


	}
	//Add/remove metrics from stack application END

/*
if (typeof horizon.d3_line_chart !== 'undefined') {
    horizon.d3_line_chart.init("div[data-chart-type='line_chart']");
  }	
*/
</script>
<!-- javascript GLOBAL VECTORS CREATED AT PAGE REFRESH ...END-->



<!-- html SELECTION OF VMS FROM A STACK_ID METRICS START -->
<!--
	N.B. se volessi far fare il submit al onchange delle combo dovrei aggiungere a ciascuna select la seguente proprietà: 
	data-line-chart-command='select_box_change'
-->
<h4>{% trans "Select Event from Stack Application" %}</h4>
<div id="ceilometer-stats">

   <form class="form-horizontal" id="linechart_general_form1">
    <div class="form-group">
      <label for="stacks" class="control-label col-sm-2">{% trans "Stack_id" %}:&nbsp;</label>
      <div class="col-sm-2">
	<!-- START added in Juno -->
        <!--<select name="stacks" id="stacks1" class="form-control" onchange="show_metrics_x_stackid(this);" style="width: auto">-->
	<select name="stacks" id="stacks1" class="form-control" onchange="show_cw_events_x_stackid(this);" style="width: auto">
	<!-- STOP added in Juno -->
          <optgroup label='{% trans "Stacks" %}'>
            <option title="--" value="--">--</option>
            {% for stack in stacks_info %}
            <option title="{{ stack.stack_name }}" value="{{ stack.stack_id }}" data-unit="">
            {{ stack.stack_name }}
            </option>
            {% endfor %}
          </optgroup>
        </select>
      </div>
    </div>
    <p id="cw_event_types1"></p>
    <p id="events_list1"></p>
    <p id="metrics_x_event1"></p>
    <p id="vms_x_event1"></p>
  </form>


<div class="info row detail">
  <div id="chart_containerst1" class="col-sm-9 chart_container" style="display:inline-block;width:75%;">
        <div id="chartst1" class="chart"
		data-chart-type="line_chart"
		data-url="{% url 'horizon:admin:event_CW:samples'%}"
		data-form-selector="#linechart_general_form1"
                data-legend-selector="#legendst1"
                data-smoother-selector="#smootherst1"
                data-slider-selector="#sliderst1">
        </div>
        <div id="sliderst1"></div>
  </div>

  &nbsp;&nbsp;
  <div id="legendst1" style="display:inline-block;width:20%;"></div>

</div> <!-- CLOSE "info row detail" -->

  <div id="afterst1">
        &nbsp;&nbsp;
        <table>
          <tr>
           <td><button class="btn btn-default btn-sm" type="submit" style="vertical-align:top;" value="1" onclick="addmetricst(this);">Add Metric</button></td>
          </tr>
        </table>
  </div>
  <!-- This is the section inside which new metric lines will be added and removed from -->
  <div id="new_metricst1"></div>

</div> <!-- CLOSE ceilometer-stats -->

